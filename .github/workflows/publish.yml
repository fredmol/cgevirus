on:
  push:
    tags:
      - '*' # Push events to matching v*, i.e. v1.0, v20.15.10

name: Create Release

jobs:
  conda-noarch:
    runs-on: ubuntu-latest
    container: conda/miniconda3:latest

    steps:
      - name: checkout repository
        uses: actions/checkout@v2

      - name: Make conda yaml
        run: |
          pip install PyYAML
          python make_conda.py

      - name: Install conda-build
        run: conda install conda-build

      - name: build conda package
        run: |
          conda build -c conda-forge -c bioconda -c defaults conda/ --output-folder .

      - name: upload conda package
        run: |
          anaconda -t ${{ secrets.GENOMICEPIDEMIOLOGY_CONDA_AUTH_TOKEN }} upload --label main noarch/*.tar.bz2
